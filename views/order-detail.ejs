    <%- include('./navbar') %>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f8f9fa; margin: 0; padding: 20px; color: #343a40; }
        .container { max-width: 900px; margin: auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .order-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #dee2e6; padding-bottom: 15px; margin-bottom: 20px; }
        h1 { margin: 0; }
        .order-details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .detail-card { padding: 20px; background-color: #f8f9fa; border-radius: 5px; }
        h3 { margin-top: 0; border-bottom: 1px solid #ddd; padding-bottom: 8px; }
        p { line-height: 1.6; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px 15px; border: 1px solid #dee2e6; text-align: left; }
        th { background-color: #f8f9fa; }
        .footer { text-align: right; font-size: 1.1em; font-weight: bold; }
        .status-form { margin-top: 20px; }
        select, button { padding: 8px; border-radius: 4px; border: 1px solid #ced4da; }
        button { background-color: #007bff; color: white; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <a href="/admin/orders">&larr; Back to Orders</a>
        <div class="order-header">
            <h1>Order #<%= order.id %></h1>
            <span><strong>Date:</strong> <%= new Date(order.created_at).toLocaleDateString() %></span>
        </div>

        <div class="order-details-grid">
            <div class="detail-card customer-details">
                <h3>Customer Details</h3>
                <p><strong>Name:</strong> <%= order.User.first_name %> <%= order.User.last_name %></p>
                <p><strong>Email:</strong> <%= order.User.email %></p>
            </div>
            <div class="detail-card shipping-address">
                <h3>Shipping Address</h3>
                <p>
                    <%= order.Address.street_address %><br>
                    <%= order.Address.city %>, <%= order.Address.state %> <%= order.Address.postal_code %><br>
                    <%= order.Address.country %><br>
                    <strong>Phone:</strong> <%= order.Address.phone_number %>
                </p>
            </div>
        </div>

        <h3 style="margin-top: 30px;">Order Items</h3>
        <table>
            <thead>
                <tr>
                    <th>Product</th>
                    <th>SKU</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                <% order.OrderItems.forEach(item => { %>
                <tr>
                    <td>
                        <%= item.product_name_snapshot %>
                        <% if(item.variant_attributes_snapshot) { %>
                            <small style="display: block; color: #6c757d;">
                                <% Object.entries(JSON.parse(item.variant_attributes_snapshot)).forEach(([key, value]) => { %>
                                    <%= key %>: <%= value %>
                                <% }); %>
                            </small>
                        <% } %>
                    </td>
                    <td><%= item.ProductVariant.sku %></td>
                    <td><%= item.quantity %></td>
                    <td>$<%= parseFloat(item.price_at_purchase).toFixed(2) %></td>
                    <td>$<%= (item.quantity * item.price_at_purchase).toFixed(2) %></td>
                </tr>
                <% }); %>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="4" class="footer">Subtotal</td>
                    <td class="footer">$<%= parseFloat(order.subtotal_amount).toFixed(2) %></td>
                </tr>
                <tr>
                    <td colspan="4" class="footer">GST</td>
                    <td class="footer">$<%= parseFloat(order.gst_amount).toFixed(2) %></td>
                </tr>
                <tr>
                    <td colspan="4" class="footer">Shipping</td>
                    <td class="footer">$<%= parseFloat(order.shipping_charge).toFixed(2) %></td>
                </tr>
                <tr>
                    <td colspan="4" class="footer"><strong>Total</strong></td>
                    <td class="footer"><strong>$<%= parseFloat(order.total_amount).toFixed(2) %></strong></td>
                </tr>
            </tfoot>
        </table>

        <div class="detail-card status-form">
            <h3>Update Order Status</h3>
            <form action="/admin/orders/update-status/<%= order.id %>" method="POST">
                <select name="status">
                    <% ['pending', 'processing', 'shipped', 'delivered', 'cancelled'].forEach(s => { %>
                        <option value="<%= s %>" <%= order.order_status === s ? 'selected' : '' %>><%= s.charAt(0).toUpperCase() + s.slice(1) %></option>
                    <% }); %>
                </select>
                <button type="submit">Update Status</button>
            </form>
        </div>
    </div>
</body>
</html>
